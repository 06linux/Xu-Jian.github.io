---
layout: post
title: Firebase实时数据库设置✔︎
tags: Ⓦ-Firebase
categories: Tool
---



## 实时数据库服务 先决条件

1. 在网页中 添加和配置 Firebase SDK

2. head 里引入 firebase.js
`<script src="https://www.gstatic.com/firebasejs/3.0.4/firebase.js"></script>`


3. footer 里 jquery 后 添加 app.js 文件.(firebase 所有脚本都放这里统一管理)

4. app.js  一开始就执行的函数. onready 函数..里面是具体的代码.

 5. firebase → 数据库 → 规则 → 测试的话 read和write:后面都改成 ”true”   
	这样才有权限修改读取数据库... 不然要验证..麻烦. 




### 官方Youtube 实例1
作用: 修改 实时数据库里面的内容. 就能本地console 出修改的值..

[https://www.youtube.com/watch?v=noB98K6A0TY][1]




#### 实例详解 Value Events:


**目的:  如何实时同步一些事件.**

1. HTML 先加个标签并给上ID.  `<pre id=“Object”><pre>`

2. 接下来所有 都在 app.js 里面执行了...


21. 绑定HTML里面新建的元素.   
	用 getElementById (也可以用 jqiery )
`const preObject = document.getElementById('Object')`

const:   
常量的意思.   
把对象转变成常数对象:  
利用condt 进行修饰的变量的值.在程序的任意位置不能再被修改.就像常数…




22. 创建引用... 引用firebase 数据库里面的东西..
`const  dbRefObject = firebase.database().ref().child('Object');`

- firebase  
应该是 firebase.js 里面定义的 就像$是jquery.js 里面定义的一样.
- database()
是一个函数吧. 就是连接数据库的意思.(这里数据库的帐号密码网址应该都是定义 配置 firebase的时候就写进去了.)
- ref()
把你带到数据库的根目录.
- child()
创建对象的一个子对象. 对象名字叫Object

现在开始  我们就可以储存任何值了..

23. on() → 同步一个字符串.
**on() 实时同步函数**
功能: 数据库里面一旦改变. 网页里面的数据也同步改变!!!!
 
`dbRefObject.on('value', snap => console.log( snap.val())); `

- 第一个参数: 事件类型
事件类型: 你用什么方式 控制与实时数据库同步的级别.
- 值事件:

-  第二个参数: 回调函数  
	这里就是值. 一旦value 的值有改变 就执行这个回调函数
这个回调函数用了 ES2015 的 =\> 箭头函数
snap : 一个 数据快照
这个snap 可以返回很多信息. 比如子对象的名称 等等….
这里要输出值的话 就用 snap.val 


24. on() → 同步一个对象.
这个 就叫 状态同步
数据库里面直接 创建对象.. 就会同步对象....
如果数据库里面改了 这个对象里面某项. 会返回整个对象.而不是仅仅修改的那个.




25. 把数据库的数据用JSON格式显示到 HTML 的pre 标签中(之前是console中的..)
	 
dbRefObject.on('value', snap =\> { 
  preObject.innerText = JSON.stringify(snap.val(),null,3);
});








#### 实例详解 Child Events:
child 事件有三个.  
`child_added  child_changed  child_removed` 
- add    → 只有实时数据库中 有数据被添加时候才会执行.
- chage  → 只有实时数据库中 有数据被修改时候才会执行.
- remove → 只有实时数据库中 有数据被删除时候才会执行.


**列表**  数据库格式:   名字: 值.    网页上只会显示值.  


firebase数据库::
hobbies:
sleep: Sleep
sex: Sex


 
`HTML: <ul id=“list”><ul>`



	const ulList = document.getElementById('List');
	const dbRefList = firebase.database().ref().child('MyAssetes');
	dbRefList.on("child_added", snap => {
	const li = document.createElement('li');
	li.innerText = snap.val();
	li.id = snap.key;
	ulList.appendChild(li);
	});
	
	dbRefList.on("child_removed", snap => {
	const liRemoved = document.getElementById(snap.key);
	liRemoved.remove();
	});
	
	dbRefList.on("child_changed", snap => {
	const liChanged = document.getElementById(snap.key);
	liChanged.innerText = snap.val();
	});


























## 获取数据库 引用

然后就可以在js中 用数据库了....



您将通过 firebase.initializeApp() 初始化 SDK：


~~~
更新之后
// Reference
var key = ref.key;
var rootRef = ref.root;
var parentRef = ref.parent;

// Query
var queryRef = query.ref;

// DataSnapshot
ref.on("value", function(snapshot) {
  var dataRef = snapshot.ref;
  var dataKey = snapshot.key;
});
~~~
{: .language-ruby}





### 更新您的身份验证代码

Firebase 身份验证功能此时存在于其自己的 firebase.auth() 服务之后，许多方法已重命名。 例如，下面是用 OAuth 提供程序对用户进行身份验证的方法：



~~~
var auth = firebase.auth();

var provider = new firebase.auth.TwitterAuthProvider();
auth.signInWithPopup(provider).then(function(result) {
  // User signed in!
  var uid = result.user.uid;
}).catch(function(error) {
  // An error occurred
});
~~~
{: .language-ruby}





## 获取访问令牌

~~~
var auth = firebase.auth();

var provider = new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider).then(function(result) {
  var accessToken = result.credential.accessToken;
});
~~~
{: .language-ruby}



## 监控身份验证状态

~~~
var auth = firebase.auth();

auth.onAuthStateChanged(function(user) {
  if (user) {
    // User signed in!
    var uid = user.uid;
  } else {
    // User logged out
  }
});
~~~
{: .language-ruby}




## 更新新重设密码模板

如果您的应用允许用户用通过电子邮件与密码身份验证登录 方式登录，可能还向这些用户提供了重设密码的选项。
您升级为新 SDK 后，这些重设密码电子邮件将使用在 Firebase 控制台指定的新模板。 请务必为满足应用需要更新这些模板。












[1]:	https://www.youtube.com/watch?v=noB98K6A0TY